<tal:title define="global title roster.str_grf_name + ' - Code reference'" />

<tal:main_template define="main_template load: main_template.pt" metal:use-macro="main_template">
<div metal:fill-slot='body'>
    <div class="container">
        <div class="row">
            <div class="span3" style="float:right;">
                <ul class="nav nav-list well">
                    <li class="nav-header">Code Reference</li>
                    <li><a href="#source_code">Obtaining source code</a></li>
                    <li><a href="#compiling">Compiling</a></li>
                    <li><a href="#railtypes_and_fallbacks">Railtypes</a></li>
                    <li><a href="#vehicle_properties">Vehicle properties</a></li>
                    <li><a href="#numeric_ids">Base numeric IDs in use</a></li>
                </ul>
            </div>
            <div class="span9">
                <h2>Code reference</h2>
                <hr />
                <section id="source_code">
                    <h3>Obtaining source code</h3>
                    <p>${roster.str_grf_name} source code is found on <a href="${metadata['repo_url']}">GitHub</a>. License is GPL v2.</p>
                </section>
                <hr />
                <br />

                <section id="compiling">
                    <h3>Compiling</h3>
                    <p>
                       ${roster.str_grf_name} source includes a makefile for convenient building.
                       This requires '<a href="https://en.wikipedia.org/wiki/Make_(software)">Make</a>',
                       typically provided by the ports tree on Linux / Unix,
                       <a href="https://developer.apple.com/xcode/">Xcode</a> on macOS,
                       and other build systems on Windows.
                    </p>
                    <p>Other dependencies include:</p>
                    <ul>
                        <li><a href="https://www.python.org/">Python 3.11+</a></li>
                        <li><a href="https://newgrf-specs.tt-wiki.net/wiki/NML:Getting_started">NML 0.7.5 or newer</a> (NewGRF compiler)</li>
                        <li><a href="http://chameleon.readthedocs.org/en/latest/">Chameleon</a> (Template engine)</li>
                        <li><a href="https://pypi.python.org/pypi/Markdown">Markdown</a> (Markdown text format parser)</li>
                    </ul>
                </section>
                <hr />
                <br />

                <section id="railtypes_and_fallbacks">
                    <h3>Railtypes</h3>
                    <p>${roster.str_grf_name} uses a very specific approach to railtypes.</p>
                    <ol>
                        <li>
                            The ${roster.str_grf_name} grf includes <em>both</em> vehicles <em>and</em> railtypes. This is unusual; it's more common to split up vehicles and railtypes to separate grfs.
                            However this puts more work on the player to find an appropriate grf, if they're even aware they need to.
                            ${roster.str_grf_name} provides <em>batteries-are-included</em> gameplay by including the appropriate railtypes.
                        </li>
                        <li>
                            Iron Horse ${roster.str_grf_name} sets labels from the <a href="https://newgrf-specs.tt-wiki.net/wiki/Standardized_Railtype_Scheme">Standardised Railtype Scheme</a> <strong>where suitable labels exist</strong>.
                            ${roster.str_grf_name} is only <strong>partially compliant</strong> with the Standardised Railtype Scheme, and uses the <a href="https://newgrf-specs.tt-wiki.net/wiki/Standardized_Railtype_Scheme#.22Innsbruck_2022_Convention.22_for_partial_compliance">"Innsbruck 2022 Convention"</a> where axle load classes are treated as "undefined".
                        </li>
                        <li>
                            Iron Horse uses other railtype labels if suitable labels are not available in the <a href="https://newgrf-specs.tt-wiki.net/wiki/Standardized_Railtype_Scheme">Standardised Railtype Scheme</a>.
                        </li>
                        <li>
                            Iron Horse may have detection and behaviour for specific railtype grfs where there is co-operation with the author(s) of the railtype grf.
                        </li>
                        <li>
                            The NML 'railtype fallback' approach is not used in Iron Horse. Iron Horse provides suitable railtypes for all vehicles by default. If another grf disables or modifies those railtypes, Iron Horse will either display an error, or some vehicles will not be available in game.
                        </li>
                    </ol>
                    <table style="font-size:84%;" class="table table-striped table-condensed table-bordered tablesorter">
                        <thead>
                            <tr>
                                <th>Railtype label</th>
                                <th>Name</th>
                                <th>Internal ID</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tal:railtypes repeat="railtype iron_horse.railtype_manager">
                                <tr>
                                    <td><code>${railtype.label}</code></td>
                                    <td>${doc_helper.lang_strings.get('STR_RAILTYPE_' + railtype.id.upper() + '_NAME', 'name string undefined')}</td>
                                    <td><code>${railtype.id}</code></td>
                                </tr>
                            </tal:railtypes>
                       </tbody>
                    </table>
                </section>
            </div>
        </div>

        <hr />

        <div class="row">
            <div class="span12">
                <section id="vehicle_properties">
                    <h3>Vehicle properties for ${len(catalogues)} trains</h3>
                    <p></p>
                    <tal:catalogues_by_model_type_cls repeat="catalogues_by_model_type_cls doc_helper.get_catalogues_by_model_type_cls(catalogues)">
                        <tal:block define="model_type_cls catalogues_by_model_type_cls['model_type_cls'];
                                           catalogues catalogues_by_model_type_cls['catalogues'];">
                            <h4 id="${model_type_cls.__name__}">${model_type_cls.__name__} <small>Subclass</small></h4>
                            <p>${model_type_cls.__doc__}</p>
                            <tal:props_to_print define="props_to_print doc_helper.get_props_to_print_in_code_reference(catalogues)">
                                <table style="font-size:84%;" class="table table-striped table-condensed table-bordered tablesorter">
                                    <thead>
                                        <tr>
                                            <th style="background-color:#eee; vertical-align:top">Sprite</th>
                                            <tal:props repeat="prop_name props_to_print.keys()">
                                                <th style="background-color:#eee; vertical-align:top">${prop_name}</th>
                                            </tal:props>
                                            <th style="background-color:#eee; vertical-align:top">Sprites Complete</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tal:default_model_variants repeat="catalogue catalogues">
                                            <tr>
                                                <td class="vehicle-image"
                                                    style="min-width:${2 * doc_helper.docs_sprite_max_width}px;">
                                                    <img src="static/img/${catalogue.default_entry.model_variant_id}_red_white.png"
                                                         width="${2 * doc_helper.docs_sprite_width(catalogue=catalogue)}"
                                                         height="${2 * doc_helper.docs_sprite_height}" />
                                                </td>
                                                <tal:props repeat="prop_name props_to_print.keys()">
                                                    <td style="${'text-align:right;' if prop_name not in ['Vehicle Name'] else None}">
                                                        ${props_to_print[prop_name][repeat.catalogue.index]}
                                                    </td>
                                                </tal:props>
                                                <td>
                                                    ${structure: "&amp;#10004;" if catalogue.model_def.sprites_complete else "&lt;span style='color:red;'&gt;Nope&lt;/span&gt;"}
                                                </td>
                                            </tr>
                                        </tal:default_model_variants>
                                    </tbody>
                                </table>
                                <br />
                            </tal:props_to_print>
                        </tal:block>
                    </tal:catalogues_by_model_type_cls>
                </section>
                <hr />
                <br />

                <section id="numeric_ids">
                    <h3>Base numeric IDs in use</h3>
                    <p class="muted">
                        Vehicles use a base numeric ID with a multiple of 10.
                        Livery variants and articulated trailing parts automatically increment in 1 from that ID, <strong>but are not listed here.</strong>
                        For example, a steam locomotive with ID 10 for the lead part would use ID 11 for the tender.
                        Vehicles may use more than 10 numeric IDs.
                    </p>
                    <table class="table table-striped table-condensed table-bordered tablesorter">
                        <thead>
                            <th>Base Numeric IDs</th>
                            <th>ID</th>
                            <th>Title</th>
                        </thead>
                        <tbody>
                            <tal:catalogues repeat="catalogue sorted(catalogues, key=lambda catalogue: catalogue.model_def.base_numeric_id)">
                                <tr>
                                    <td>${', '.join([str(i) for i in catalogue.factory.numeric_id_blocks_consumed])}</td>
                                    <td>${catalogue.model_id}</td>
                                    <td>${doc_helper.unpack_name_string(catalogue)}</td>
                                </tr>
                            </tal:catalogues>
                        </tbody>
                    </table>
                </section>

            </div>
        </div>
    </div>
</div>
</tal:main_template>
